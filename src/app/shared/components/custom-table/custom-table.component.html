<div class="card border-0">
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead>
                <tr>
                    <th *ngFor="let col of columns" scope="col">
                        {{ col.label }}
                    </th>
                </tr>

                <tr *ngIf="hasFilterableColumns" class="bg-light">
                    <th *ngFor="let col of columns" class="p-2">
                        <input *ngIf="col.filterable" type="text" class="form-control shadow-none"
                            [placeholder]="'Filtrar ' + col.label.toLowerCase()" [(ngModel)]="filterValues[col.key]"
                            (ngModelChange)="applyFilters()">
                    </th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let row of paginatedData">
                    <td *ngFor="let col of columns">

                        <ng-container [ngSwitch]="col.type || 'text'">

                            <span *ngSwitchCase="'text'" class="fw-medium">{{ getValue(row, col) }}</span>

                            <div *ngSwitchCase="'image'" class="d-flex align-items-center position-relative"
                                style="width: fit-content;">
                                <img [src]="row[col.key] || 'assets/placeholder.png'"
                                    class="rounded-circle object-fit-cover" width="40" height="40">

                                <label
                                    class="btn btn-sm btn-upload position-absolute start-50 top-50 translate-middle rounded-circle shadow-sm p-0 d-flex align-items-center justify-content-center"
                                    style="width: 28px; height: 28px; cursor: pointer;">
                                    <i class="bi bi-camera-fill small"></i>
                                    <input type="file" hidden
                                        (change)="onFileSelected.emit({row: row, file: $any($event.target).files[0]})"
                                        accept="image/*">
                                </label>
                            </div>

                            <div *ngSwitchCase="'toggle'" class="form-check form-switch d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" role="switch" [checked]="row[col.key]"
                                    style="cursor: pointer;"
                                    (change)="onToggle.emit({row: row, key: col.key, checked: $any($event.target).checked})">
                            </div>

                            <div *ngSwitchCase="'icon'">
                                <i class="bi h5 mb-0" [ngClass]="row[col.key]"
                                    [style.color]="row['iconColor'] || 'inherit'"></i>
                            </div>

                            <div *ngSwitchCase="'action'" class="d-flex gap-1">
                                <button class="btn-action" (click)="onAction.emit({action: 'edit', row: row})"
                                    title="Editar">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                                <button class="btn-action btn-delete"
                                    (click)="onAction.emit({action: 'delete', row: row})" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>

                        </ng-container>
                    </td>
                </tr>

                <tr *ngIf="paginatedData.length === 0">
                    <td [attr.colspan]="columns.length" class="text-center py-5">
                        <div class="text-muted opacity-50">
                            <i class="bi bi-search display-6 d-block mb-3"></i>
                            <span class="h6 fw-normal">No se encontraron resultados</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="card-footer" *ngIf="totalPages > 1">
        <div class="d-flex justify-content-between align-items-center w-100">
            <div class="small text-muted">
                Mostrando <span class="fw-semibold text-dark">{{ paginatedData.length }}</span> de <span
                    class="fw-semibold text-dark">{{ filteredData.length }}</span> resultados
            </div>

            <nav aria-label="Table navigation">
                <ul class="pagination mb-0">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                        <button class="page-link" (click)="changePage(currentPage - 1)">
                            <i class="bi bi-chevron-left small"></i>
                        </button>
                    </li>

                    <li class="page-item" *ngFor="let p of visiblePages" [class.active]="p === currentPage"
                        [class.disabled]="p === '...'">
                        <button class="page-link" (click)="changePage(p)">
                            {{ p }}
                        </button>
                    </li>

                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                        <button class="page-link" (click)="changePage(currentPage + 1)">
                            <i class="bi bi-chevron-right small"></i>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>