<div class="card border-0">
    <div class="table-responsive">

        <table class="table align-middle mb-0" [ngClass]="tableClass">

            <thead class="border-bottom">
                <tr>
                    <th *ngFor="let col of columns" scope="col" class="fw-semibold text-secondary py-3"
                        [style.width]="col.width || 'auto'">
                        {{ col.label }}
                    </th>
                </tr>

                <tr *ngIf="hasFilterableColumns" class="bg-light">
                    <th *ngFor="let col of columns" class="p-2 border-0">
                        <input *ngIf="col.filterable" type="text"
                            class="form-control form-control-sm shadow-none border" [placeholder]="'Buscar...'"
                            [(ngModel)]="filterValues[col.key]" (ngModelChange)="applyFilters()">
                    </th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let row of paginatedData; let i = index" class="border-bottom">
                    <td *ngFor="let col of columns" class="py-3">

                        <ng-container [ngSwitch]="col.type || 'text'">

                            <span *ngSwitchCase="'index'" class="text-muted small fw-medium">
                                {{ (currentPage - 1) * pageSize + i + 1 }}
                            </span>

                            <span *ngSwitchCase="'text'" class="text-dark">
                                {{ getValue(row, col) }}
                            </span>

                            <div *ngSwitchCase="'image'" style="width: 40px; height: 40px;">
                                <img [src]="row[col.key] || 'assets/placeholder.png'"
                                    class="w-100 h-100 rounded-circle object-fit-cover bg-light border">
                            </div>

                            <span *ngSwitchCase="'badge'" class="badge rounded-pill fw-normal"
                                [ngClass]="col.classCallback ? col.classCallback(row[col.key], row) : 'bg-secondary'">
                                {{ getValue(row, col) }}
                            </span>

                            <div *ngSwitchCase="'tags'" class="d-flex flex-wrap gap-1">
                                <span *ngFor="let tag of (col.tagsCallback ? col.tagsCallback(row) : [])"
                                    class="badge rounded-1 fw-normal" [ngClass]="tag.class">
                                    {{ tag.label }}
                                </span>
                            </div>

                            <div *ngSwitchCase="'toggle'" class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" [checked]="row[col.key]"
                                    style="cursor: pointer;"
                                    (change)="onToggle.emit({row: row, key: col.key, checked: $any($event.target).checked})">
                            </div>

                            <div *ngSwitchCase="'action'" class="d-flex gap-2">
                                <button *ngIf="row['permissionCount'] !== undefined" class="btn-action"
                                    (click)="onAction.emit({action: 'permissions', row: row})"
                                    title="Gestionar permisos">
                                    <i class="bi bi-key"></i>
                                </button>
                                <button class="btn-action btn-edit" (click)="onAction.emit({action: 'edit', row: row})"
                                    title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn-action btn-delete"
                                    (click)="onAction.emit({action: 'delete', row: row})" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>

                            <ng-container *ngSwitchCase="'template'">
                                <ng-container *ngTemplateOutlet="col.templateRef; context: { $implicit: row }">
                                </ng-container>
                            </ng-container>

                        </ng-container>
                    </td>
                </tr>

                <tr *ngIf="paginatedData.length === 0">
                    <td [attr.colspan]="columns.length" class="text-center py-5 text-muted">
                        No se encontraron registros
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="card-footer bg-white border-top-0 py-3" *ngIf="totalPages > 1">
        <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted">
                {{ paginatedData.length }} de {{ filteredData.length }} registros
            </small>

            <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link border-0 text-dark" (click)="changePage(currentPage - 1)">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                </li>
                <li class="page-item" *ngFor="let p of visiblePages" [class.active]="p === currentPage"
                    [class.disabled]="p === '...'">
                    <button class="page-link border-0 rounded mx-1"
                        [ngClass]="p === currentPage ? 'bg-primary text-white' : 'text-dark'" (click)="changePage(p)">
                        {{ p }}
                    </button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages">
                    <button class="page-link border-0 text-dark" (click)="changePage(currentPage + 1)">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</div>