<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="h3 fw-bold mb-1">Reporte de Compras</h2>
            <p class="text-muted mb-0">Detalle de adquisiciones y gastos por proveedor</p>
        </div>
    </div>

    <!-- Filters -->
    <div class="card border-0 shadow-sm bg-white mb-4">
        <div class="card-body py-3">
            <div class="row align-items-end g-3">
                <div class="col-md-3">
                    <label class="form-label small fw-bold text-muted">Fecha Inicio</label>
                    <input type="date" class="form-control" [(ngModel)]="startDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label small fw-bold text-muted">Fecha Fin</label>
                    <input type="date" class="form-control" [(ngModel)]="endDate">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100 fw-bold" (click)="loadReport()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-search me-2" viewBox="0 0 16 16">
                            <path
                                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                        </svg>
                        Generar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100 border-start border-4 border-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Total Compras</p>
                            <h3 class="fw-bold mb-0 text-warning">{{ getTotalPurchases() | currency:'PEN':'S/ ' }}</h3>
                        </div>
                        <div class="text-warning opacity-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                                class="bi bi-bag-check" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0" />
                                <path
                                    d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100 border-start border-4 border-secondary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-muted small text-uppercase fw-bold mb-1">Operaciones</p>
                            <h3 class="fw-bold mb-0 text-secondary">{{ purchases().length }}</h3>
                        </div>
                        <div class="text-secondary opacity-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                                class="bi bi-files" viewBox="0 0 16 16">
                                <path
                                    d="M13 0H6a2 2 0 0 0-2 2 2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2 2 2 0 0 0 2-2V2a2 2 0 0 0-2-2m0 13V4a2 2 0 0 0-2-2H5a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1M3 4a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Data -->
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-muted small text-uppercase">
                        <tr>
                            <th class="ps-4">Fecha</th>
                            <th>Proveedor</th>
                            <th>Documento</th>
                            <th class="text-end">Total</th>
                            <th class="text-center">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="isLoading()">
                            <td colspan="5" class="text-center py-5">
                                <div class="spinner-border text-primary" role="status"></div>
                            </td>
                        </tr>
                        <tr *ngIf="!isLoading() && purchases().length === 0">
                            <td colspan="5" class="text-center py-5 text-muted">No se encontraron compras en el rango
                                seleccionado.</td>
                        </tr>
                        <tr *ngFor="let purchase of purchases()">
                            <td class="ps-4">
                                <div class="fw-bold">{{ purchase.issueDate | date:'dd/MM/yyyy' }}</div>
                            </td>
                            <td class="fw-medium">{{ purchase.supplierName }}</td>
                            <td>
                                <span class="badge bg-light text-dark border me-1">{{ purchase.documentType }}</span>
                                <span class="fw-medium font-monospace">{{ purchase.series }}-{{ purchase.number
                                    }}</span>
                            </td>
                            <td class="text-end fw-bold">{{ purchase.total | currency:'PEN':'S/ ' }}</td>
                            <td class="text-center">
                                <span class="badge rounded-pill bg-success"
                                    *ngIf="purchase.status === 'RECEIVED'">Recibido</span>
                                <span class="badge rounded-pill bg-danger"
                                    *ngIf="purchase.status === 'CANCELED'">Anulado</span>
                                <span class="badge rounded-pill bg-warning text-dark"
                                    *ngIf="purchase.status === 'PENDING'">Pendiente</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>