<div class="roles-list-container">
    <div class="page-header d-flex justify-content-end align-items-center mb-4">
        <p-button label="Nuevo Rol" icon="bi bi-plus-lg" (onClick)="createRole()" [raised]="true"></p-button>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="row g-3 align-items-center">
                <div class="col-md-8">
                    <p-iconfield iconPosition="left">
                        <p-inputicon class="bi bi-search"></p-inputicon>
                        <input type="text" pInputText class="w-100" placeholder="Buscar por nombre o descripci贸n..."
                            [value]="searchTerm()" (input)="onSearchChange($any($event.target).value)" />
                    </p-iconfield>
                </div>
                <div class="col-md-4">
                    <p-select [options]="statusOptions" [ngModel]="selectedStatusFilter()"
                        (onChange)="onStatusFilterChange($event)" optionLabel="label" optionValue="value" class="w-100"
                        placeholder="Filtrar por estado"></p-select>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <p-table [value]="filteredRoles()" [loading]="isLoading()" [rows]="10" [paginator]="true"
            [responsiveLayout]="'scroll'" styleClass="p-datatable-striped p-datatable-sm" [showCurrentPageReport]="true"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} roles">

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="name">Rol <p-sortIcon field="name"></p-sortIcon></th>
                    <th>Descripci贸n</th>
                    <th>Permisos</th>
                    <th pSortableColumn="active">Estado <p-sortIcon field="active"></p-sortIcon></th>
                    <th pSortableColumn="createdAt">Fecha Creaci贸n <p-sortIcon field="createdAt"></p-sortIcon></th>
                    <th class="text-end">Acciones</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-role>
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="role-icon-circle me-3">
                                <i class="bi bi-shield-fill text-primary"></i>
                            </div>
                            <span class="fw-bold">{{ role.name }}</span>
                        </div>
                    </td>
                    <td>
                        <span class="text-muted">{{ role.description || 'Sin descripci贸n' }}</span>
                    </td>
                    <td>
                        <p-tag [value]="getPermissionCount(role) + ' permisos'" severity="secondary"
                            [rounded]="true"></p-tag>
                    </td>
                    <td>
                        <p-tag [severity]="role.active ? 'success' : 'warn'"
                            [value]="role.active ? 'Activo' : 'Inactivo'" [rounded]="true"></p-tag>
                    </td>
                    <td>
                        <small class="text-muted">{{ role.createdAt | date:'dd/MM/yyyy' }}</small>
                    </td>
                    <td>
                        <div class="d-flex justify-content-end gap-2">
                            <p-button icon="bi bi-pencil" [text]="true" [rounded]="true" severity="primary"
                                (onClick)="editRole(role.id)" pTooltip="Editar"></p-button>

                            <p-button icon="bi bi-key" [text]="true" [rounded]="true" severity="info"
                                (onClick)="managePermissions(role.id)" pTooltip="Gestionar permisos"></p-button>

                            <p-button [icon]="role.active ? 'bi bi-toggle-on' : 'bi bi-toggle-off'" [text]="true"
                                [rounded]="true" [severity]="role.active ? 'warn' : 'success'"
                                (onClick)="toggleActive(role)"
                                [pTooltip]="role.active ? 'Desactivar' : 'Activar'"></p-button>

                            <p-button icon="bi bi-trash" [text]="true" [rounded]="true" severity="danger"
                                (onClick)="deleteRole(role)" pTooltip="Eliminar"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="6">
                        <div class="text-center py-5">
                            <i class="bi bi-inbox display-4 text-muted mb-3"></i>
                            <p class="text-muted">No se encontraron roles</p>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>