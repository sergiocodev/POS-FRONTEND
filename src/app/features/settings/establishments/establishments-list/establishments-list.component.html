<div class="establishments-list-container">
    <div class="page-header d-flex justify-content-end align-items-center mb-4">
        <p-button label="Nuevo Establecimiento" icon="bi bi-plus-lg" (onClick)="createEstablishment()"
            [raised]="true"></p-button>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="row g-3 align-items-center">
                <div class="col-md-8">
                    <p-iconfield iconPosition="left">
                        <p-inputicon class="bi bi-search"></p-inputicon>
                        <input type="text" pInputText class="w-100"
                            placeholder="Buscar por nombre, dirección o código..." [value]="searchTerm()"
                            (input)="onSearchChange($any($event.target).value)" />
                    </p-iconfield>
                </div>
                <div class="col-md-4">
                    <p-select [options]="statusOptions" [ngModel]="selectedStatusFilter()"
                        (onChange)="onStatusFilterChange($event)" optionLabel="label" optionValue="value" class="w-100"
                        placeholder="Filtrar por estado"></p-select>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <p-table [value]="filteredEstablishments()" [loading]="isLoading()" [rows]="10" [paginator]="true"
            [responsiveLayout]="'scroll'" styleClass="p-datatable-striped p-datatable-sm" [showCurrentPageReport]="true"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} establecimientos">

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="name">Establecimiento <p-sortIcon field="name"></p-sortIcon></th>
                    <th>Dirección</th>
                    <th pSortableColumn="codeSunat">Cód. SUNAT <p-sortIcon field="codeSunat"></p-sortIcon></th>
                    <th pSortableColumn="active">Estado <p-sortIcon field="active"></p-sortIcon></th>
                    <th class="text-end">Acciones</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-establishment>
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="est-icon-circle me-3">
                                <i class="bi bi-shop text-primary"></i>
                            </div>
                            <span class="fw-bold">{{ establishment.name }}</span>
                        </div>
                    </td>
                    <td>
                        <span class="text-muted">{{ establishment.address || 'Sin dirección' }}</span>
                    </td>
                    <td>
                        <code class="text-primary fw-semibold">{{ establishment.codeSunat }}</code>
                    </td>
                    <td>
                        <p-tag [severity]="establishment.active ? 'success' : 'warn'"
                            [value]="establishment.active ? 'Activo' : 'Inactivo'" [rounded]="true"></p-tag>
                    </td>
                    <td>
                        <div class="d-flex justify-content-end gap-2">
                            <p-button icon="bi bi-pencil" [text]="true" [rounded]="true" severity="primary"
                                (onClick)="editEstablishment(establishment.id)" pTooltip="Editar"></p-button>

                            <p-button [icon]="establishment.active ? 'bi bi-toggle-on' : 'bi bi-toggle-off'"
                                [text]="true" [rounded]="true" [severity]="establishment.active ? 'warn' : 'success'"
                                (onClick)="toggleEstablishmentStatus(establishment)"
                                [pTooltip]="establishment.active ? 'Desactivar' : 'Activar'"></p-button>

                            <p-button icon="bi bi-trash" [text]="true" [rounded]="true" severity="danger"
                                (onClick)="deleteEstablishment(establishment)" pTooltip="Eliminar"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="5">
                        <div class="text-center py-5">
                            <i class="bi bi-building-exclamation display-4 text-muted mb-3"></i>
                            <p class="text-muted">No se encontraron establecimientos</p>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>